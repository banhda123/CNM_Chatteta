{"ast":null,"code":"import { io } from 'socket.io-client';\nimport { API_URL } from './api';\nlet socket = null;\nexport const connectSocket = token => {\n  if (socket) {\n    socket.disconnect();\n  }\n  socket = io(API_URL, {\n    auth: {\n      token: `Bearer ${token}`\n    },\n    reconnection: true,\n    reconnectionAttempts: 5,\n    reconnectionDelay: 1000,\n    timeout: 10000,\n    transports: ['websocket', 'polling']\n  });\n  socket.on('connect_error', error => {\n    console.error('Socket connection error:', error);\n    if (error.message.includes('invalid signature')) {\n      // Token không hợp lệ, xóa token và chuyển hướng đến trang đăng nhập\n      localStorage.removeItem('token');\n      window.location.href = '/login';\n    }\n  });\n  return socket;\n};\nexport const disconnectSocket = () => {\n  if (socket) {\n    socket.disconnect();\n    socket = null;\n  }\n};\nexport const getSocket = () => socket;\nexport const socketEvents = {\n  // User events\n  UPDATE_STATUS: 'update-status',\n  STATUS_CHANGED: 'status-changed',\n  // Friend events\n  FRIEND_REQUEST: 'friend-request',\n  FRIEND_REQUEST_ACCEPTED: 'friend-request-accepted',\n  FRIEND_REQUEST_REJECTED: 'friend-request-rejected',\n  FRIEND_REMOVED: 'friend-removed',\n  // Chat events\n  JOIN_CONVERSATION: 'join-conversation',\n  LEAVE_CONVERSATION: 'leave-conversation',\n  SEND_MESSAGE: 'send-message',\n  NEW_MESSAGE: 'new-message',\n  MESSAGE_DELIVERED: 'message-delivered',\n  MESSAGE_READ: 'message-read',\n  // File events\n  FILE_UPLOADED: 'file-uploaded',\n  FILE_DOWNLOADED: 'file-downloaded'\n};","map":{"version":3,"names":["io","API_URL","socket","connectSocket","token","disconnect","auth","reconnection","reconnectionAttempts","reconnectionDelay","timeout","transports","on","error","console","message","includes","localStorage","removeItem","window","location","href","disconnectSocket","getSocket","socketEvents","UPDATE_STATUS","STATUS_CHANGED","FRIEND_REQUEST","FRIEND_REQUEST_ACCEPTED","FRIEND_REQUEST_REJECTED","FRIEND_REMOVED","JOIN_CONVERSATION","LEAVE_CONVERSATION","SEND_MESSAGE","NEW_MESSAGE","MESSAGE_DELIVERED","MESSAGE_READ","FILE_UPLOADED","FILE_DOWNLOADED"],"sources":["D:/CNM/CNM_Zalo_Nhom10/frontend/src/services/socket.js"],"sourcesContent":["import { io } from 'socket.io-client';\r\nimport { API_URL } from './api';\r\n\r\nlet socket = null;\r\n\r\nexport const connectSocket = (token) => {\r\n  if (socket) {\r\n    socket.disconnect();\r\n  }\r\n\r\n  socket = io(API_URL, {\r\n    auth: {\r\n      token: `Bearer ${token}`\r\n    },\r\n    reconnection: true,\r\n    reconnectionAttempts: 5,\r\n    reconnectionDelay: 1000,\r\n    timeout: 10000,\r\n    transports: ['websocket', 'polling']\r\n  });\r\n\r\n  socket.on('connect_error', (error) => {\r\n    console.error('Socket connection error:', error);\r\n    if (error.message.includes('invalid signature')) {\r\n      // Token không hợp lệ, xóa token và chuyển hướng đến trang đăng nhập\r\n      localStorage.removeItem('token');\r\n      window.location.href = '/login';\r\n    }\r\n  });\r\n\r\n  return socket;\r\n};\r\n\r\nexport const disconnectSocket = () => {\r\n  if (socket) {\r\n    socket.disconnect();\r\n    socket = null;\r\n  }\r\n};\r\n\r\nexport const getSocket = () => socket;\r\n\r\nexport const socketEvents = {\r\n  // User events\r\n  UPDATE_STATUS: 'update-status',\r\n  STATUS_CHANGED: 'status-changed',\r\n  \r\n  // Friend events\r\n  FRIEND_REQUEST: 'friend-request',\r\n  FRIEND_REQUEST_ACCEPTED: 'friend-request-accepted',\r\n  FRIEND_REQUEST_REJECTED: 'friend-request-rejected',\r\n  FRIEND_REMOVED: 'friend-removed',\r\n  \r\n  // Chat events\r\n  JOIN_CONVERSATION: 'join-conversation',\r\n  LEAVE_CONVERSATION: 'leave-conversation',\r\n  SEND_MESSAGE: 'send-message',\r\n  NEW_MESSAGE: 'new-message',\r\n  MESSAGE_DELIVERED: 'message-delivered',\r\n  MESSAGE_READ: 'message-read',\r\n  \r\n  // File events\r\n  FILE_UPLOADED: 'file-uploaded',\r\n  FILE_DOWNLOADED: 'file-downloaded'\r\n}; "],"mappings":"AAAA,SAASA,EAAE,QAAQ,kBAAkB;AACrC,SAASC,OAAO,QAAQ,OAAO;AAE/B,IAAIC,MAAM,GAAG,IAAI;AAEjB,OAAO,MAAMC,aAAa,GAAIC,KAAK,IAAK;EACtC,IAAIF,MAAM,EAAE;IACVA,MAAM,CAACG,UAAU,CAAC,CAAC;EACrB;EAEAH,MAAM,GAAGF,EAAE,CAACC,OAAO,EAAE;IACnBK,IAAI,EAAE;MACJF,KAAK,EAAE,UAAUA,KAAK;IACxB,CAAC;IACDG,YAAY,EAAE,IAAI;IAClBC,oBAAoB,EAAE,CAAC;IACvBC,iBAAiB,EAAE,IAAI;IACvBC,OAAO,EAAE,KAAK;IACdC,UAAU,EAAE,CAAC,WAAW,EAAE,SAAS;EACrC,CAAC,CAAC;EAEFT,MAAM,CAACU,EAAE,CAAC,eAAe,EAAGC,KAAK,IAAK;IACpCC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAChD,IAAIA,KAAK,CAACE,OAAO,CAACC,QAAQ,CAAC,mBAAmB,CAAC,EAAE;MAC/C;MACAC,YAAY,CAACC,UAAU,CAAC,OAAO,CAAC;MAChCC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;IACjC;EACF,CAAC,CAAC;EAEF,OAAOnB,MAAM;AACf,CAAC;AAED,OAAO,MAAMoB,gBAAgB,GAAGA,CAAA,KAAM;EACpC,IAAIpB,MAAM,EAAE;IACVA,MAAM,CAACG,UAAU,CAAC,CAAC;IACnBH,MAAM,GAAG,IAAI;EACf;AACF,CAAC;AAED,OAAO,MAAMqB,SAAS,GAAGA,CAAA,KAAMrB,MAAM;AAErC,OAAO,MAAMsB,YAAY,GAAG;EAC1B;EACAC,aAAa,EAAE,eAAe;EAC9BC,cAAc,EAAE,gBAAgB;EAEhC;EACAC,cAAc,EAAE,gBAAgB;EAChCC,uBAAuB,EAAE,yBAAyB;EAClDC,uBAAuB,EAAE,yBAAyB;EAClDC,cAAc,EAAE,gBAAgB;EAEhC;EACAC,iBAAiB,EAAE,mBAAmB;EACtCC,kBAAkB,EAAE,oBAAoB;EACxCC,YAAY,EAAE,cAAc;EAC5BC,WAAW,EAAE,aAAa;EAC1BC,iBAAiB,EAAE,mBAAmB;EACtCC,YAAY,EAAE,cAAc;EAE5B;EACAC,aAAa,EAAE,eAAe;EAC9BC,eAAe,EAAE;AACnB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}